# Form Builder with flutter_form_builder

## Overview

This guide refactors the manual `Form` + `TextFormField` setup to use `flutter_form_builder` with richer validators and easier access to field values.

---

## Step 1: Add Form Builder Imports

**Command:** Run this in your terminal to add dependencies:

```
flutter pub add flutter_form_builder form_builder_validators
```

Add the Form Builder packages:

```dart
import 'package:flutter_form_builder/flutter_form_builder.dart';
import 'package:form_builder_validators/form_builder_validators.dart';
```

These enable `FormBuilder`, `FormBuilderTextField`, and the bundled validators.

---

## Step 2: Switch to FormBuilderState Key

**Location:** In `_MyFormState`

Replace the `FormState` key with `FormBuilderState`:

```dart
// Before:
final GlobalKey<FormState> _formKey = GlobalKey<FormState>();

// After:
final GlobalKey<FormBuilderState> _formKey = GlobalKey<FormBuilderState>();
```

This key type gives access to Form Builder conveniences like field lookup and value maps.

---

## Step 3: Replace Form + TextFormField with FormBuilder Widgets

**Location:** In the widget tree where the `Form` and `TextFormField`s were defined

Wrap fields in `FormBuilder` and swap each `TextFormField` for `FormBuilderTextField` with field names, null-safe `onChanged`, and composed validators:

```dart
// Before:
Form(
  key: _formKey,
  child: Column(
    children: [
      TextFormField(
        decoration: const InputDecoration(labelText: "Firstname"),
        onChanged: (value) => setState(() {
          _firstname = value;
        }),
        validator: (value) {
          if (value == null || value.isEmpty) {
            return 'Please enter some text';
          }
          return null;
        },
      ),
      TextFormField(
        decoration: const InputDecoration(labelText: "Lastname"),
        onChanged: (value) => setState(() {
          _lastname = value;
        }),
        validator: (value) {
          if (value == null || value.isEmpty) {
            return 'Please enter some text';
          }
          return null;
        },
      ),
    ],
  ),
),

// After:
FormBuilder(
  key: _formKey,
  child: Column(
    children: [
      FormBuilderTextField(
        name: "firstname",
        decoration: const InputDecoration(labelText: "Firstname"),
        onChanged: (value) => setState(() {
          _firstname = value ?? "";
        }),
        validator: FormBuilderValidators.compose([
          FormBuilderValidators.required(),
          FormBuilderValidators.minLength(3),
        ]),
      ),
      FormBuilderTextField(
        name: "lastname",
        decoration: const InputDecoration(labelText: "Lastname"),
        onChanged: (value) => setState(() {
          _lastname = value ?? "";
        }),
        validator: FormBuilderValidators.compose([
          FormBuilderValidators.required(),
          FormBuilderValidators.minLength(3),
        ]),
      ),
    ],
  ),
),
```

Key changes:

- Use `FormBuilder` instead of `Form`
- Use `FormBuilderTextField` with a required `name`
- Handle nullable `onChanged` values with `?? ""`
- Add stronger validation via `FormBuilderValidators.compose`, `required`, and `minLength(3)`

---

## Step 4: Update Submit Logic

**Location:** The "Submit" button callback

Validate via Form Builder and gate further actions on `isValid`. Also show how to read values from the form state:

```dart
// Before:
onPressed: () {
  _formKey.currentState!.validate();
},

// After:
onPressed: () {
  _formKey.currentState?.validate();
  if (_formKey.currentState?.isValid ?? false) {
    debugPrint(
      "Firstname: ${_formKey.currentState?.fields["firstname"]?.value}",
    );
    debugPrint(
      "Lastname: ${_formKey.currentState?.fields["lastname"]?.value}",
    );
  }
},
```

This uses Form Builder's state to validate and fetch field values without separate controllers.

---

## Step 5: Keep Clear Logic but Reset Form Builder

**Location:** The "Clear" button callback

Reset both local state and the Form Builder fields:

```dart
// Before:
onPressed: () {
  setState(() {
    _firstname = "";
    _lastname = "";
  });
  _formKey.currentState?.reset();
},

// After (logic unchanged, works with FormBuilder):
onPressed: () {
  setState(() {
    _firstname = "";
    _lastname = "";
  });
  _formKey.currentState?.reset();
},
```

Reset continues to clear the form fields and validation messages.
